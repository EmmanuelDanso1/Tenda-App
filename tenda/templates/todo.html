{% extends "index.html" %}
{% block content %}
<div class="container">
    <form action="" method="POST">
        <div class="mb-3">
            <label for="title" class="form-label">Todo Title</label>
            <input type="text" class="form-control" name="title" id="title" placeholder="Type your title">
        </div>
        <div class="mb-3">
            <label for="description" class="form-label">Todo Description</label>
            <input type="text" class="form-control" name="description" id="description" placeholder="Type your description">
        </div>
        <div>
            <button type="submit" class="btn btn-primary">Submit</button>
        </div>
    </form>
</div>

<div class="container my-3">
    {% if alltodo|length == 0 %}
    <p>No Todo Task</p>
    {% else %}
    <p>Your Todo</p>
    <table class="table">
        <thead>
            <tr>
                <th scope="col">ID</th>
                <th scope="col">Title</th>
                <th scope="col">Description</th>
                <th scope="col">Date</th>
                <th scope="col">Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for todo in alltodo %}
            <tr>
                <th scope="row">{{ loop.index }}</th>
                <td>{{ todo.title }}</td>
                <td>{{ todo.description }}</td>
                <td>{{ todo.time.strftime("%Y-%m-%d") }}</td>
                <td>
                    <a href="{{ url_for('update_todo', id=todo.id) }}" class="btn btn-sm mx-2 btn-success">Update</a>

                    <button type="button" class="btn btn-sm mx-2 btn-danger" data-bs-toggle="modal" data-bs-target="#deleteModal{{ todo.id }}">Delete</button>

                    <div class="checking mx-2">
                      <label id="checkboxLabel{{ todo.id }}">
                          <input type="checkbox" id="myCheckbox{{ todo.id }}"> Check to complete
                      </label>
                      <div class="css-loader" id="cssLoader{{ todo.id }}"></div>
                    </div>
                </td>
            </tr>

            <!-- Script to handle task completion -->
            <script>
                $(document).ready(function() {
                    $('#myCheckbox{{ todo.id }}').click(function() {
                        // Hide checkbox and show loader
                        $(this).hide();
                        $('#cssLoader{{ todo.id }}').show();

                        // Simulate an AJAX call with a timeout
                        setTimeout(function() {
                            // Hide the loader and change the label to "Task Completed"
                            $('#cssLoader{{ todo.id }}').hide();
                            $('#checkboxLabel{{ todo.id }}').html('Task Completed').css("color", "green").css("font-size", "15px");
                        }, 3000); // Adjust the timeout as needed (3000ms = 3s)
                    });
                });
            </script>

            <!-- Delete Modal -->
            <div class="modal fade" id="deleteModal{{ todo.id }}" tabindex="-1" aria-labelledby="deleteModalLabel{{ todo.id }}" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="deleteModalLabel{{ todo.id }}">Are you sure you want to delete this todo?</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">No</button>
                            <form action="{{ url_for('delete_todo', id=todo.id) }}" method="POST">
                                <input type="submit" value="Yes" class="btn btn-danger">
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </tbody>
    </table>
    {% endif %}
</div>

<!-- CSS for loader -->
 <style>
  .checking {
      display: inline-flex;
      align-items: center;
    }
  .css-loader {
  border: 4px solid #f3f3f3; /* Light grey */
  border-top: 4px solid #3498db; /* Blue */
  border-radius: 50%;
  width: 20px;
  height: 20px;
  animation: spin 2s linear infinite;
  display: none; /* Initially hidden */
}


@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

 </style>

{% endblock %}
